---
- name: Configure | postgres | listen_address
  lineinfile:
    state: present
    dest: /etc/postgresql/9.3/main/postgresql.conf
    regexp: '^#* *listen_addresses ='
    line: "listen_addresses = '*'"
  notify: Reload Service | postgres
  tags:
    - networking
  when: postgres_accepts_external_connections

- name: Configure | postgres | pg_hba.conf
  lineinfile:
    state: present
    dest: /etc/postgresql/9.3/main/pg_hba.conf
    regexp: "^#* *host {{ item }}"
    line: "host {{ item }} {{ database_username | default(project) }} all md5"
  with_items:
    - template1
    - "{{ database_name | default(project) }}"
  notify: Reload Service | postgres
  tags:
    - networking
  when: postgres_accepts_external_connections
